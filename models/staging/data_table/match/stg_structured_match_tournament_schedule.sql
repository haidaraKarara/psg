with match_tournament_schedule as (

    select * from {{ source('raw_data', 'match_tournament_schedule') }}
),
structured_match as (

    select

    	value:matchInfo:id::string as matchId,
        value:matchInfo:description::string as description,
        value:matchInfo:sport:id::string as sportId,
        value:matchInfo:sport:name::string as sportName,
        value:matchInfo:ruleset:id::string as rulesetId,
        value:matchInfo:ruleset:name::string as rulesetName,
        value:matchInfo:competition:id::string as competitionId,
        value:matchInfo:competition:name::string as competitionName,
        value:matchInfo:competition:competitionCode::string as competitionCode,
        value:matchInfo:competition:competitionFormat::string as competitionFormat,
        value:matchInfo:competition:country:id::string as countryId,
        value:matchInfo:competition:country:name::string as countryName,
        value:matchInfo:tournamentCalendar:id::string as tournamentCalendarId,
        value:matchInfo:tournamentCalendar:name::string as tournamentCalendarName,
        try_to_date(regexp_replace(value:matchInfo:tournamentCalendar:startDate,'z|Z')) as tournamentCalendarStartDate,
        try_to_date(regexp_replace(value:matchInfo:tournamentCalendar:endDate,'z|Z')) as tournamentCalendarEndDate,
        value:matchInfo:stage:id::string as stageId,
        value:matchInfo:stage:formatId::string as stageformatId,
        value:matchInfo:stage:name::string as stageName,
        try_to_date(regexp_replace(value:matchInfo:stage:startDate,'z|Z')) as stageStartDate,
        try_to_date(regexp_replace(value:matchInfo:stage:endDate,'z|Z')) as stageEndDate,
        value:matchInfo:series:id::string as seriesId,
        value:matchInfo:series:formatId::string as seriesformatId,
        value:matchInfo:series:name::string as seriesName,
        value:matchInfo:venue:id::string as venueId,
        value:matchInfo:venue:neutral::string as venueNeutral,
        value:matchInfo:venue:longName::string as venueLongName,
        value:matchInfo:venue:shortName::string as venueShortName,
     	value:liveData:matchDetails:matchStatus::string as matchStatus,
        value:liveData:matchDetails:winner::string as winner,
        value:matchInfo:contestant[0].code::string as contestantCode_1,
        value:matchInfo:contestant[0].id::string as contestantId_1,
        value:matchInfo:contestant[0].name::string as contestantName_1,
        value:matchInfo:contestant[0].shortName::string as contestantShortName_1,
        value:matchInfo:contestant[0].officialName::string as contestantOfficialName_1,
        value:matchInfo:contestant[0].position::string as contestantPosition_1,
        value:matchInfo:contestant[0].country:id::string as contestantCountryId_1,
        value:matchInfo:contestant[0].country:name::string as contestantCountryName_1,
        value:matchInfo:contestant[1].code::string as contestantCode_2,
        value:matchInfo:contestant[1].id::string as contestantId_2,
        value:matchInfo:contestant[1].name::string as contestantName_2,
        value:matchInfo:contestant[1].shortName::string as contestantShortName_2,
        value:matchInfo:contestant[1].officialName::string as contestantOfficialName_2,
        value:matchInfo:contestant[1].position::string as contestantPosition_2,
        value:matchInfo:contestant[1].country:id::string as contestantCountryId_2,
        value:matchInfo:contestant[1].country:name::string as contestantCountryName_2,
        value:liveData:goal::variant as goal,
		value:liveData:matchDetails:scores:ht:home::int as scoresHtHome,
        value:liveData:matchDetails:scores:ht:away::int as scoresHtAway,
        value:liveData:matchDetails:scores:ft:home::int as scoresFtHome,
        value:liveData:matchDetails:scores:ft:away::int as scoresFtAway,
        value:liveData:matchDetails:scores:total:home::int as scoresTotalHome,
        value:liveData:matchDetails:scores:total:away::int as scoresTotalAway,
        value:liveData:lineUp[0].contestantId::string as lineUpContestantId_1,
        value:liveData:lineUp[0].formationUsed::int as lineUpFormationUsed_1,
        value:liveData:lineUp[0].player::variant as lineUpPlayer_1,
        value:liveData:lineUp[0].teamOfficial:id::string as lineUpTeamOfficialId_1,
        value:liveData:lineUp[0].teamOfficial:firstName::string as lineUpTeamOfficialFirstName_1,
        value:liveData:lineUp[0].teamOfficial:lastName::string as lineUpTeamOfficialLastName_1,
        value:liveData:lineUp[0].teamOfficial:type::string as lineUpTeamOfficialType_1,
        value:liveData:lineUp[0].kit:id::int as lineUpKitId_1,
        value:liveData:lineUp[0].kit:colour1::string as lineUpKitColour1_1,
        value:liveData:lineUp[0].kit:colour2::string as lineUpKitColour2_1,
        value:liveData:lineUp[0].kit:type::string as lineUpKitType_1,
        value:liveData:lineUp[0].stat::variant as lineUpStat_1,
		value:liveData:lineUp[1].contestantId::string as lineUpContestantId_2,
        value:liveData:lineUp[1].formationUsed::int as lineUpFormationUsed_2,
        value:liveData:lineUp[1].player::variant as lineUpPlayer_2,
        value:liveData:lineUp[1].teamOfficial:id::string as lineUpTeamOfficialId_2,
        value:liveData:lineUp[1].teamOfficial:firstName::string as lineUpTeamOfficialFirstName_2,
        value:liveData:lineUp[1].teamOfficial:lastName::string as lineUpTeamOfficialLastName_2,
        value:liveData:lineUp[1].teamOfficial:type::string as lineUpTeamOfficialType_2,
        value:liveData:lineUp[1].kit:id::int as lineUpKitId_2,
        value:liveData:lineUp[1].kit:colour1::string as lineUpKitColour1_2,
        value:liveData:lineUp[1].kit:colour2::string as lineUpKitColour2_2,
        value:liveData:lineUp[1].kit:type::string as lineUpKitType_2,
        value:liveData:lineUp[1].stat::variant as lineUpStat_2,
        value:liveData:substitute::variant as substitute,
        value:liveData:card::variant as card,
        value:liveData:matchDetailsExtra:attendance::int as attendance,
        value:liveData:matchDetailsExtra:matchOfficial::variant as matchOfficial,
        value:liveData:matchDetails:matchLengthMin::int as matchLengthMin,
    	value:matchInfo:coverageLevel::int as coverageLevel,
        try_to_date(regexp_replace(value:matchInfo:date,'z|Z')) as MatchDate,
        try_to_time(regexp_replace(value:matchInfo:time,'z|Z')) as MatchTime,
        try_to_date(regexp_replace(value:matchInfo:localDate,'z|Z')) as MatchLocalDate,
        try_to_time(regexp_replace(value:matchInfo:localTime,'z|Z')) as MatchLocalTime,
    	value:matchInfo:week::int as week,
    	value:matchInfo:postMatch::int as postMatch,
    	value:matchInfo:numberOfPeriods::int as numberOfPeriods,
    	value:matchInfo:periodLength::int as periodLength,
        try_to_timestamp(regexp_replace(value:matchInfo:lastUpdated,'z|Z')) as lastUpdated, 
    	value:liveData:VAR::variant as liveDataVAR,
        v as src

    from match_tournament_schedule,
    lateral flatten ( input => v:match)
)

select * from structured_match